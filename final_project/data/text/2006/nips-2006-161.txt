A recipe for optimizing a time-histogram

Hideaki Shimazaki
Department of Physics, Graduate School of Science
Kyoto University
Kyoto 606-8502, Japan
shimazaki@ton.scphys.kyoto-u.ac.jp

Shigeru Shinomoto
Department of Physics, Graduate School of Science
Kyoto University
Kyoto 606-8502, Japan
shinomoto@scphys.kyoto-u.ac.jp

Abstract

The time-histogram method is a handy tool for capturing the instantaneous rate
of spike occurrence. In most of the neurophysiological literature, the bin size that
critically determines the goodness of the ﬁt of the time-his togram to the underly-
ing rate has been selected by individual researchers in an unsystematic manner.
We propose an objective method for selecting the bin size of a time-histogram
from the spike data, so that the time-histogram best approximates the unknown
underlying rate. The resolution of the histogram increases, or the optimal bin size
decreases, with the number of spike sequences sampled. It is notable that the op-
timal bin size diverges if only a small number of experimental trials are available
from a moderately ﬂuctuating rate process. In this case, any attempt to character-
ize the underlying spike rate will lead to spurious results. Given a paucity of data,
our method can also suggest how many more trials are needed until the set of data
can be analyzed with the required resolution.

1

Introduction

The rate of spike occurrence, or the ﬁring rate, of a neuron ca n be captured by the (peri-stimulus)
time-histogram (PSTH) [1, 2], which is constructed easily as follows: Align spike sequences to the
onset of stimuli, divide time into discrete bins, count the number of spikes that enter each bin, and
divide the counts by the bin size and the number of sequences. The shape of a PSTH depends on the
choice of the bin size. With too large a bin size, one cannot represent the detailed time-dependent
rate, while with too small a bin size, the time-histogram ﬂuc tuates greatly and one cannot discern
the underlying spike rate. There exists an ideal bin size for estimating the spike rate for each set
of experimental data. This important parameter has mostly been selected subjectively by individual
researchers.

We devised a method of selecting the bin size objectively so that a PSTH best approximates the
underlying rate, which is unknown. In the course of our study, we found an interesting paper that
proposed an empirical method of choosing the histogram bin size for a probability density function
(Rudemo M, (1982) Scandinavian Journal of Statistics 9: 65-78 [3]). Although applicable to a Pois-
son point process, this theory appears to have rarely been applied to PSTHs. It would be preferable
to have a theory in accordance with the procedures of neurophysiological experiments in which a
stimulus is repeated to extract a signal from a neuron. Given a set of experimental data, we wish to

not only determine the optimal bin size, but also estimate how many more experimental trials should
be performed in order to obtain a resolution we deem sufﬁcien t.

It was revealed by a theoretical analysis that the optimal bin size may diverge for a small number
of spike sequences derived from a moderately ﬂuctuating rat e [4]. This implies that any attempt to
characterize the underlying rate will lead to spurious results. The present method can indicate the
divergence of the optimal bin size only from the spike data. Even under such a condition, the present
method nevertheless provides an inference on the number of trails that need to be performed in order
to obtain a meaningful estimated rate.

2 Methods

We consider sequences of spikes repeatedly recorded from identical experimental trials. A recent
analysis revealed that in vivo spike trains are not simply random, but possess inter-spike-interval
distributions intrinsic and speci ﬁc to individual neurons
[5, 6]. However, spikes accumulated from
a large number of spike trains recorded from a single neuron are, in the majority, mutually inde-
pendent. Being free from the intrinsic inter-spike-interval distributions of individual spike trains,
the accumulated spikes can be regarded as being derived repeatedly from Poisson processes of an
identical time-dependent rate [7, 8].

It would be natural to assess the goodness of the ﬁt of the esti mator ˆλt to the underlying spike rate
λt over the total observation period T by the mean integrated squared error (MISE),
T Z T
1
0
where E refers to the expectation over different realization of point events, given λt . We suggest
a method for minimizing the MISE with respect to the bin size ∆. The difﬁculty of the present
problem comes from the fact that the underlying spike rate λt is not known.

E (ˆλt − λt )2 dt,

MISE ≡

(1)

2.1 Selection of the bin size

We choose the (bar-graph) PSTH as a way to estimate the rate ˆλt , and explore a method to select
the bin size of a PSTH that minimizes MISE in Eq.(1). A PSTH is constructed simply by counting
the number of spikes that belong to each bin. For an observation period T , we obtain N = ⌊T /∆⌋
intervals. The number of spikes accumulated from all n sequences in the ith interval is counted as
ki . The bar height at the ith bin is given by ki /n∆.
Given a bin of width ∆, the expected height of a bar graph for t ∈ [0, ∆] is the time-averaged rate,
∆ Z ∆
1
0
The total number of spikes k from n spike sequences that enter a bin of width ∆ obeys a Poisson
distribution with the expected number n∆θ ,

λt dt.

θ =

(2)

p(k | n∆θ) =

(n∆θ)k
k !
The unbiased estimator for θ is given as ˆθ = k/(n∆), which is the empirical height of the bar graph
for t ∈ [0, ∆].
By segmenting the total observation period T into N intervals of size ∆, the MISE deﬁned in Eq.(1)
can be rewritten as

e−n∆θ .

(3)

1
N

MISE =

N
∆ Z ∆
1
Xi=1 nE ( ˆθi − λt+(i−1)∆ )2o dt,
0
where ˆθi ≡ ki/(n∆). Hereafter we denote the average over those segmented rate λt+(i−1)∆ as an
average over an ensemble of (segmented) rate functions {λt} deﬁned in an interval of
t ∈ [0, ∆]:
∆ Z ∆
1
0 DE ( ˆθ − λt )2E dt.

MISE =

(4)

(5)

(i)

(ii)

(iii)

(iv)

Table 1: A method for bin size selection for a PSTH

Divide the observation period T into N bins of width ∆, and count
the number of spikes ki from all n sequences that enter the ith bin.

¯k ≡

Construct the mean and variance of the number of spikes {ki } as,
N
N
1
1
Xi=1
Xi=1
N
N
Compute the cost function,

ki , and v ≡

(ki − ¯k)2 .

Cn (∆) =

2¯k − v
(n∆)2

.

Repeat i through iii while changing the bin size ∆ to search for ∆∗
that minimizes Cn (∆).

(6)

MISE =

The expectation E now refers to the average over the spike count, or ˆθ = k/(n∆), given a rate
function λt , or its mean value, θ . The MISE can be decomposed into two parts,
∆ Z ∆
∆ Z ∆
1
1
0 DE ( ˆθ − θ + θ − λt )2E dt = DE ( ˆθ − θ)2E +
0 D(λt − θ)2E dt.
ctuation of the estimator ˆθ around the
The ﬁrst and second terms are respectively the stochastic ﬂu
expected mean rate θ , and the temporal ﬂuctuation of λt around its mean θ over an interval of length
∆, averaged over the segments.
The second term of Eq.(6) can further be decomposed into two parts,
∆ Z ∆
∆ Z ∆
1
1
0 D(λt − hθi)2E dt − D(θ − hθi)2E .
0 (cid:10)(λt − hθi + hθi − θ)2 (cid:11) dt =
The ﬁrst term in the rhs of Eq.(7) represents a mean squared ﬂu
ctuation of the underlying rate λt
from the mean rate hθi, and is independent of the bin size ∆, because
∆ Z ∆
T Z T
1
1
0 D(λt − hθi)2E dt =
0
We deﬁne a cost function by subtracting this term from the ori ginal MISE,
∆ Z ∆
1
0 D(λt − hθi)2E dt
Cn (∆) ≡ MISE −
= DE ( ˆθ − θ)2E − D(θ − hθi)2E .
This cost function corresponds to the “risk function” in the
report by Rudemo, (Eq. 2.3), obtained by
direct decomposition of the MISE [3]. The second term in Eq.(9) represents the temporal ﬂuctuation
of the expected mean rate θ for individual intervals of period ∆. As the expected mean rate is not
an observable quantity, we must replace the ﬂuctuation of th e expected mean rate with that of the
observable estimator ˆθ . Using the decomposition rule for an unbiased estimator (E ˆθ = θ),
DE ( ˆθ − hE ˆθi)2E = DE ( ˆθ − θ + θ − hθi)2E = DE ( ˆθ − θ)2E + D(θ − hθi)2E ,
the cost function is transformed into
Cn (∆) = 2 DE ( ˆθ − θ)2E − DE ( ˆθ − hE ˆθi)2E .

(λt − hθi)2 dt.

(11)

(10)

(9)

(7)

(8)

Due to the assumed Poisson nature of the point process, the number of spikes k counted in each bin
obeys a Poisson distribution: the variance of k is equal to the mean. For the estimated rate deﬁned
as ˆθ = k/(n∆), this variance-mean relation corresponds to

E ˆθ.

E ( ˆθ − θ)2 =

1
n∆
By incorporating Eq.(12) into Eq.(11), the cost function is given as a function of the estimator ˆθ ,
2
n∆ DE ˆθE − DE ( ˆθ − hE ˆθi)2E .
The optimal bin size is obtained by minimizing the cost function Cn (∆):
Cn (∆).
∆∗ ≡ arg min
∆

Cn (∆) =

(13)

(14)

(12)

By replacing the expectation of ˆθ in Eq.(13) with the sample spike counts, the method is converted
into a user-friendly recipe summarized in Table 1.

2.2 Extrapolation of the cost function

With the method developed in the preceding subsection, we can determine the optimal bin size for
a given set of experimental data. In this section, we develop a method to estimate how the optimal
bin size decreases when more experimental trials are added to the data set.

(15)

(16)

E ˆθn ,

E ˆθm =

we obtain

E ( ˆθm − θ)2 =

Assume that we are in possession of n spike sequences. The ﬂuctuation of the expected mean rate
ime-histogram ˆθn using the
(cid:10)(θ − hθi)2 (cid:11) in Eq.(10) is replaced with the empirical ﬂuctuation of the t
decomposition rule for the unbiased estimator ˆθn satisfying E ˆθn = θ ,
DE ( ˆθn − hE ˆθn i)2E = DE ( ˆθn − θ + θ − hθi)2E = DE ( ˆθn − θ)2E + (cid:10)(θ − hθi)2 (cid:11) .
The expected cost function for m sequences can be obtained by substituting the above equation into
Eq.(9), yielding
Cm (∆|n) = DE ( ˆθm − θ)2E + DE ( ˆθn − θ)2E − DE ( ˆθn − hE ˆθn i)2E .
Using the variance-mean relation for the Poisson distribution, Eq.(12), and
1
1
m∆
m∆
n (cid:19) 1
Cm (∆|n) = (cid:18) 1
1
∆ DE ˆθnE + Cn (∆) ,
m
where Cn (∆) is the original cost function, Eq.(13), computed using the estimators ˆθn . By replacing
the expectation with sample spike count averages, the cost function for m sequences can be extrap-
olated as Cm (∆|n) with this formula, using the sample mean ¯k and variance v of the numbers of
spikes, given n sequences and the bin size ∆. The extrapolation method is summarized in Table 2.
It may come to pass that the original cost function Cn (∆) computed for n spike sequences does not
have a minimum, or have a minimum at a bin size comparable to the observation period T . In such a
case, with the method summarized in Table 2, one may estimate the critical number of sequences nc
above which the cost function has a ﬁnite bin size ∆∗ , and consider carrying out more experiments
to obtain a reasonable rate estimation.
In the case that the optimal bin size exhibits continuous
divergence, the cost function can be expanded as
Cn (∆) ∼ µ (cid:18) 1
nc (cid:19) 1
1
1
∆2 ,
n
∆
where we have introduced nc and u, which are independent of n. The optimal bin size undergoes
a phase transition from the vanishing 1/∆∗ for n < nc to a ﬁnite 1/∆∗ for n > nc . In this case,
the inverse optimal bin size is expanded in the vicinity of nc as 1/∆∗ ∝ (1/n − 1/nc ). We can

(19)

−

+ u

(17)

(18)

−

Table 2: A method for extrapolating the cost function for a PSTH

Construct the extrapolated cost function,
n (cid:19) ¯k
Cm (∆|n) = (cid:18) 1
1
n∆2 + Cn (∆),
−
m
using the sample mean ¯k and variance v of the number of spikes
obtained from n sequences of spikes.

Search for ∆∗
m that minimizes Cm (∆|n).

Repeat A and B while changing m, and plot 1/∆∗
m vs 1/m to search for
the critical value 1/m = 1/ˆnc above which 1/∆∗
m practically vanishes.

(A)

(B)

(C)

estimate the critical value ˆnc by applying this asymptotic relation to the set of ˆ∆∗
m estimated from
Cm (∆|n) for various values of m:

ˆnc (cid:19) .
∝ (cid:18) 1
1
m
It should be noted that there are cases that the optimal bin size exhibits discontinuous divergence
from a ﬁnite value. Even in such cases, the plot of {1/m, 1/∆∗ } could be useful in exploring a
discontinuous transition from nonvanishing values of 1/∆∗ to practically vanishing values.

1
∆∗
m

(20)

−

2.3 Theoretical cost function

In this section, we obtain a “theoretical ” cost function dir
ectly from a process with a known un-
derlying rate, λt , and compare it with the “empirical ” cost function which can
be evaluated without
knowing the rate process. Note that this theoretical cost function is not available in real experimental
conditions in which the underlying rate is not known.

(21)

(22)

p (k |θ)

=

θ
n∆

.

Cn (∆) =

∂ 2 log p (k |θ)
∂ θ2

The present estimator ˆθ ≡ k/(n∆) is a uniformly minimum variance unbiased estimator (UMVUE)
of θ , which achieves the lower bound of the Cram ´er-Rao inequality [9, 10],
#−1
E ( ˆθ − θ)2 = "−
∞
Xk=0
Inserting this into Eq.(9), the cost function is represented as
hθi
− D(θ − hθi)2E
n∆
0 Z ∆
∆2 Z ∆
1
µ
φ (t1 − t2 ) dt1dt2 ,
−
n∆
0
where µ is the mean rate, and φ(t) is the autocorrelation function of the rate ﬂuctuation, λt − µ.
Based on the symmetry φ(t) = φ(−t), the cost function can be rewritten as
∆2 Z ∆
µ
1
(∆ − |t|)φ(t) dt
n∆
−∆
∆2 Z ∞
∆ Z ∞
1
1
µ
n∆
−∞
−∞
which can be identi ﬁed with Eq.(19) with parameters given by
nc = µ (cid:30)Z ∞
−∞
u = Z ∞
|t|φ(t) dt.
−∞

Cn (∆) =

|t|φ(t) dt,

φ(t) dt +

φ(t) dt ,

(23)

(24)

(25)

=

−

−

≈

+IJBK?JE

-FEHE?=?IJBK?JE
6DAHAJE?=?IJBK?JE

)
 











 

!

"

#

*

+

,

$
!


 
$


$
!


$
!









7@AHOECH=JA

J



5FEA5AGKA?AI



0EIJCH=I 

J


6EAJ

 

 

 

Figure 1: A: (Dots): The empirical cost function, Cn (∆), computed from spike data according to
the method in Table 1. (Solid line): The “theoretical ” cost f unction computed directly from the
underlying ﬂuctuating rate, with Eq.(22). B: (Above): The u nderlying ﬂuctuating rate λt . (Middle):
Spike sequences derived from the rate. (Below): Time-histograms made using three types of bin
sizes: too small, optimal, and too large. Model parameters: the number of sequences n = 30; total
observation period T = 30 [sec]; the mean rate µ = 30 [1/s]; the amplitude of rate ﬂuctuation
σ = 10 [1/s]; time scale of rate ﬂuctuation τ = 0.05 [s].

3 Results

Our ﬁrst objective was to develop a method for selecting the i deal bin size using spike sequences
derived repeatedly from Poisson processes, all with a given identical rate λt . The MISE of the
PSTH from the underlying rate is minimized by minimizing the cost function Cn (∆). Figure 1A
displays the cost function computed with the method summarized in Table 1. This “empirical ” cost
function is compared with the “theoretical ” cost function E q.(22) that is computed directly from
the underlying rate λt . The ﬁgure exhibits that the “empirical ” cost function is co
nsistent with the
“theoretical ” cost function. The time-histogram construc ted using the optimal bin size is compared
with those constructed using non-optimal bin sizes in Figs. 1B, demonstrating the effectiveness of
the present method of bin size selection.

We also tested a method for extrapolating the cost function. Figures 2A and B demonstrate
the extrapolated cost functions for several sequences with differing values of m and the plot of
{1/m, 1/∆∗ } for estimating the critical value 1/m = 1/ˆnc , above which 1/∆∗ practically van-
ishes. Figure 2C depicts the critical number ˆnc estimated from the smaller or larger numbers of
spike sequences n. The empirically estimated critical number ˆnc approximates the theoretically
predicted critical number nc computed using Eq.(24). Note that the critical number is correctly es-
timated from the small number of sequences, with which the optimal bin size practically diverges
(n < nc ).

4 Summary

We have developed a method for optimizing the bin size, so that the PSTH best represents the
(unknown) underlying spike rate. For a small number of spike sequences derived from a modestly

)



#



#

-NJH=F=JA@?IJBK?JE

*



 

!



 

"

$

&



 

$



-IJE=JA@FJE=>EIEA

 

$




-IJE=JA@?HEJE?=K>AH

?

+

"

!

 








"
!
 
K>AHBIAGKA?AI

Figure 2: A: Extrapolated cost functions Cm (∆|n) plotted against 1/∆ for several numbers of se-
quences m = 10, 20 and 30 computed from n = 10 sample sequences. B: The plot of {1/m, 1/∆∗ }
used for estimating the critical value 1/m = 1/ˆnc , above which 1/∆∗ practically vanishes. C: The
number of spike sequences n used to obtain the extrapolated cost function Cm (∆|n) and an esti-
mated critical number ˆnc . Model parameters: the number of sequences n = 10; total observation
period T = 30 [sec]; the mean rate µ = 30 [1/s]; the amplitude of rate ﬂuctuation σ = 4 [1/s]; time
scale of rate ﬂuctuation τ = 0.05 [s]. The theoretical critical number is computed with Eq.(24),
giving nc = 21.1 for the present underlying ﬂuctuating rate. This theoretic al nc is depicted as the
horizontal dashed line.

ﬂuctuating rate, the cost function does not have a minimum, i mplying the uselessness of the rate
estimation. Our method can nevertheless extrapolate the cost function for any number of spike
sequences, and suggest how many trials are needed in order to obtain a meaningful time-histogram
with the required accuracy. The suitability of the present method was demonstrated by application
to spike sequences generated by time-dependent Poisson processes.

Acknowledgements

This study is supported in part by Grants-in-Aid for Scienti ﬁc Research to SS from the Ministry of
Education, Culture, Sports, Science and Technology of Japan (16300068, 18020015) and the 21st
Century COE “Center for Diversity and Universality in Physi cs ”. HS is supported by the Research
Fellowship of the Japan Society for the Promotion of Science for Young Scientists.

References

[1] E. D. Adrian. The Basis of Sensation: The Action of the Sense Organs. W.W. Norton, New
York, 1928.
[2] G. L. Gerstein and N. Y. S. Kiang. An approach to the quantitative analysis of electrophysio-
logical data from single neurons. Biophysical Journal, 1(1):15–28, 1960.
[3] M. Rudemo. Empirical choice of histograms and kernel density estimators. Scandinavian
Journal of Statistics, 9(2):65–78, 1982.

[4] S. Koyama and S. Shinomoto. Histogram bin width selection for time-dependent poisson
processes. Journal of Physics A-Mathematical and General, 37(29):7255–7265, 2004.
[5] S. Shinomoto, K. Shima, and J. Tanji. Differences in spiking patterns among cortical neurons.
Neural Computation, 15(12):2823–2842, 2003.
[6] S. Shinomoto, Y. Miyazaki, H. Tamura, and I. Fujita. Regional and laminar differences in in
vivo ﬁring patterns of primate cortical neurons.
Journal of Neurophysiology, 94(1):567–575,
2005.
[7] D. L. Snyder. Random Point Processes. John Wiley & Sons, Inc., New York, 1975.
[8] D. J. Daley and D. Vere-Jones. An Introduction to the Theory of Point Processes. Springer-
Verlag, New York, USA, 1988.
[9] R. E. Blahut. Principles and practice of information theory. Addison-Wesley, Reading, Mass,
1987.
[10] T. M. Cover and J. A. Thomas. Elements of Information Theory. John Wiley & Sons, Inc.,
New York, 1991.

