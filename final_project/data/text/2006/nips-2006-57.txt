Approximate inference using planar graph
decomposition

Amir Globerson Tommi Jaakkola
Computer Science and Artiﬁcial Intelligence Laboratory
Massachusetts Institute of Technology
Cambridge, MA 02139
gamir,tommi@csail.mit.edu

Abstract

A number of exact and approximate methods are available for inference calcu-
lations in graphical models. Many recent approximate methods for graphs with
cycles are based on tractable algorithms for tree structured graphs. Here we base
the approximation on a different tractable model, planar graphs with binary vari-
ables and pure interaction potentials (no external ﬁeld). The partition function for
such models can be calculated exactly using an algorithm introduced by Fisher and
Kasteleyn in the 1960s. We show how such tractable planar models can be used
in a decomposition to derive upper bounds on the partition function of non-planar
models. The resulting algorithm also allows for the estimation of marginals. We
compare our planar decomposition to the tree decomposition method of Wain-
wright et. al., showing that it results in a much tighter bound on the partition
function, improved pairwise marginals, and comparable singleton marginals.

Graphical models are a powerful tool for modeling multivariate distributions, and have been suc-
cessfully applied in various ﬁelds such as coding theory and image processing. Applications of
graphical models typically involve calculating two types of quantities, namely marginal distribu-
tions, and MAP assignments. The evaluation of the model partition function is closely related to
calculating marginals [12]. These three problems can rarely be solved exactly in polynomial time,
and are provably computationally hard in the general case [1]. When the model conforms to a tree
structure, however, all these problems can be solved in polynomial time. This has prompted exten-
sive research into tree based methods. For example, the junction tree method [6] converts a graphical
model into a tree by clustering nodes into cliques, such that the graph over cliques is a tree. The
resulting maximal clique size (cf. tree width) may nevertheless be prohibitively large.
Wainwright et. al.
[9, 11] proposed an approximate method based on trees known as tree re-
weighting (TRW). The TRW approach decomposes the potential vector of a graphical model into
a mixture over spanning trees of the model, and then uses convexity arguments to bound various
quantities, such as the partition function. One key advantage of this approach is that it provides
bounds on partition function value, a property which is not shared by approximations based on
Bethe free energies [13].
In this paper we focus on a different class of tractable models: planar graphs. A graph is called
planar if it can be drawn in the plane without crossing edges. Works in the 1960s by physicists
Fisher [5] and Kasteleyn [7], among others, have shown that the partition function for planar graphs
may be calculated in polynomial time. This, however, is true under two key restrictions. One is that
the variables xi are binary. The other is that the interaction potential depends only on xixj (where
xi ∈ {±1}), and not on their individual values (i.e., the zero external ﬁeld case).
Here we show how the above method can be used to obtain upper bounds on the partition function
for non-planar graphs. As in TRW, we decompose the potential of a non-planar graph into a sum

over spanning planar models, and then use a convexity argument to obtain an upper bound on the log
partition function. The bound optimization is a convex problem, and can be solved in polynomial
time. We compare our method with TRW on a planar graph with an external ﬁeld, and show that it
performs favorably with respect to both pairwise marginals and the bound on the partition function,
and the two methods give similar results for singleton marginals.

1 Deﬁnitions and Notations

Given a graph G with n vertices and a set of edges E , we are interested in pairwise Markov Random
Fields (MRF) over the graph G. A pairwise MRF [13] is a multivariate distribution over variables
x = {x1 , . . . , xn } deﬁned as
P
1
p(x) =
ij∈E fij (xi ,xj )
(1)
e
partition function is deﬁned as Z = P
Z
P
where fij are a set of |E | functions, or interaction potentials, deﬁned over pairs of variables. The
ij∈E fij (xi ,xj ) . Here we will focus on the case where
x e
xi ∈ {±1}. Furthermore, we will be interested in interaction potentials which only depend on
agreement or disagreement between the signs of their variables. We deﬁne those by
1
2 θij (1 + xixj ) = θij I (xi = xj )
f (xi , xj ) =
(2)
so that fij (xi , xj ) is zero if xi 6= xj and θij if xi = xj . The model is then deﬁned via the set of
parameters θij . We use θ to denote the vector of parameters θij , and denote the partition function
by Z (θ) to highlight its dependence on these parameters.
A graph G is deﬁned as planar if it can be drawn in the plane without any intersection of edges [4].
With some abuse of notation, we deﬁne E as the set of line segments in <2 corresponding to the
edges in the graph. The regions of <2 \ E are deﬁned as the faces of the graph. The face which
corresponds to an unbounded region is called the external face. Given a planar graph G, its dual
graph G∗ is deﬁned in the following way: the vertices of G∗ correspond to faces of G, and there is
an edge between two vertices in G∗ iff the two corresponding faces in G share an edge. If the graph
G is weighted, the weight on an edge in G∗ is the weight on the edge shared by the corresponding
faces in G.
A plane triangulation of a planar graph G is obtained from G by adding edges such that all the faces
of the resulting graph have exactly three vertices. Thus a plane triangulated graph has a dual where
all vertices have degree three. It can be shown that every plane graph can be plane triangulated [4].
We shall also need the notion of a perfect matching on a graph. A perfect matching on a graph G is
deﬁned as a set of edges H ⊆ E such that every vertex in G has exactly one edge in H incident on
it. If the graph is weighted, the weight of the matching is deﬁned as the product of the weights of
the edges in the matching.
Finally, we recall the deﬁnition of a marginal polytope of a graph [12]. Consider an MRF over a
graph G where fij are given by Equation 2. Denote the probability of the event I (xi = xj ) under
p(x) by τij . The marginal polytope of G, denoted by M(G), is deﬁned as the set of values τij that
can be obtained under some assignment to the parameters θij . For a general graph G the polytope
M(G) cannot be described using a polynomial number of inequalities. However, for planar graphs,
it turns out that a set of O(n3 ) constraints, commonly referred to as triangle inequalities, sufﬁce to
describe M(G) (see [3] page 434). The triangle inequalities are deﬁned by 1
TRI(n) = {τij : τij + τjk − τik ≤ 1, τij + τjk + τik ≥ 1, ∀i, j, k ∈ {1, . . . , n}}
(3)
Note that the above inequalities actually contain variables τij which do not correspond to edges in
the original graph G. Thus the equality M(G) = TRI(n) should be understood as referring only
to the values of τij that correspond to edges in the graph. Importantly, the values of τij for edges
not in the graph need not be valid marginals for any MRF. In other words M(G) is a projection of
TRI(n) on the set of edges of G. It is well known that the marginal polytope for trees is described
via pairwise constraints. It is thus interesting that for planar graphs, it is triplets, rather than pairwise

1The deﬁnition here is slightly different from that in [3], since here we refer to agreement probabilities,
whereas [3] refers to disagreement probabilities. This polytope is also referred to as the cut polytope.

constraints, that characterize the polytope. In this sense, planar graphs and trees may be viewed as
a hierarchy of polytope complexity classes. It remains an interesting problem to characterize other
structures in this hierarchy and their related inference algorithms.

2 Exact calculation of partition function using perfect matching

The seminal works of Kasteleyn [7] and Fisher [5] have shown how one can calculate the partition
function for a binary MRF over a planar graph with pure interaction potentials. We brieﬂy review
Fisher’s construction, which we will use in what follows. Our interpretation of the method differs
somewhat from that of Fisher, but we believe it is more straightforward. The key idea in calculating
the partition function is to convert the summation over values of x to the problem of calculating the
sum of weights of all perfect matchings in a graph constructed from G, as shown below.
In this section, we consider weighted graphs (graphs with numbers assigned to their edges). For the
graph G associated with the pairwise MRF, we assign weights wij = e2θij to the edges. The ﬁrst
step in the construction is to plane triangulate the graph G. Let us call the resulting graph GT . We
deﬁne an MRF on GT by assigning a parameter θij = 0 to the edges that have been added to G,
and the corresponding weight wij = 1. Thus GT essentially describes the same distribution as G,
and therefore has the same partition function. We can thus restrict our attention to calculating the
partition function for the MRF on GT .
As a ﬁrst step in calculating a partition function over GT , we introduce the following deﬁnition: a
set of edges ˆE in GT is an agreement edge set (or AES) if for every triangle face F in GT one of the
following holds: The edges in F are all in ˆE , or exactly one of the edges in F is in ˆE . The weight
of a set ˆE is deﬁned as the product of the weights of the edges in ˆE .
It can be shown that there exists a bijection between pairs of assignments {x, −x} and agreement
edge sets. The mapping from x to an edge set is simply the set of edges such that xi = xj . It is easy
to see that this is an agreement edge set. The reverse mapping is obtained by ﬁnding an assignment
x such that xi = xj iff the corresponding edge is in the agreement edge set. The existence of this
P
mapping can be shown by induction on the number of (triangle) faces.
ij∈E θij I (xi=xj ) . If x corre-
The contribution of a given assignment x to the partition function is e
Y
sponds to an AES denoted by ˆE it is easy to see that
P
P
ij∈E θij I (xi=xj ) = e− P
P
ij∈ ˆE 2θij = c e
ij∈E θij e
e
where c = e− P
ij∈ ˆE
implies that Z (θ) = 2c P
Q
ij∈E θij . Deﬁne the superset Λ as the set of agreement edge sets. The above then
ij∈ ˆE wij , and is thus proportional to the sum of AES weights.
ˆE∈Λ
To sum over agreement edge sets, we use the following elegant trick introduced by Fisher [5].
Construct a new graph GPM from the dual of GT by introducing new vertices and edges according to
the following rule: Replace each original vertex with three vertices that are connected to each other,
and assign a weight of one to the new edges. Next, consider the three neighbors of the original
vertex 2 . Connect each of the three new vertices to one of these three neighbors, keeping the original
weights on these edges. The transformation is illustrated in Figure 1.
the set of perfect matchings in GPM . Then Z (θ) = 2c P
Q
The new graph GPM has O(3n) vertices, and is also planar. It can be seen that there is a one to one
correspondence between perfect matchings in GPM and agreement edge sets in GT . Deﬁne Ω to be
ij∈M wij where we have used the
M ∈Ω
fact that all the new weights have a value of one. Thus, the partition function is a sum over the
weights of perfect matchings in GPM . Finally, we need a way of summing over the weights of the set
of perfect matchings in a graph. Kasteleyn [7] proved that for a planar graph GPM , this sum may be
obtained using the following sequence of steps:
• Direct the edges of the graph GPM such that for every face (except possibly the external
face), the number of edges on its perimeter oriented in a clockwise manner is odd. Kaste-
leyn showed that such a so called Pfafﬁan orientation may be constructed in polynomial
time for a planar graph (see also [8] page 322).

ij∈ ˆE 2θij = c

wij

(4)

2Note that in the dual of GT all vertices have degree three, since GT is plane triangulated.

Figure 1: Illustration of the graph transformations in Section 2 for a complete graph with four vertices. Left
panel shows the original weighted graph (dotted edges and grey vertices) and its dual (solid edges and black
vertices). Right panel shows the dual graph with each vertex replaced by a triangle (the graph GPM in the text).
Weights for dual graph edges correspond to the weights on the original graph.
• Deﬁne the matrix P (GPM ) to be a skew symmetric matrix such that Pij = 0 if ij is not an
• The sum over weighted matchings can then be shown to equal p|P (GPM )|.
edge, Pij = wij if the arrow on edge ij runs from i to j and Pij = −wij otherwise.
The partition function is thus given by Z (θ) = 2cp|P (GPM )|. To conclude this section we reiterate
the following two key points:
the partition function of a binary MRF over a planar graph with
interaction potentials as in Equation 2 may be calculated in polynomial time by calculating the
determinant of a matrix of size O(3n). An important outcome of this result is that the functional
relation between Z (θ) and the parameters θij is known, a fact we shall use in what follows.

3 Partition function bounds via planar decomposition

Given a non-planar graph G over binary variables with a vector of interaction potentials θ , we wish
to use the exact planar computation to obtain a bound on the partition function of the MRF on G.
We assume for simplicity that the potentials on the MRF for G are given in the form of Equation 2.
Thus, G violates the assumptions of the previous section only in its non-planarity. Deﬁne G(r) as a
set of spanning planar subgraphs of G, i.e., each graph G(r) is planar and contains all the vertices of
G and some its edges. Denote by m the number of such graphs. Introduce the following deﬁnitions:
• θ(r) is a set of parameters on the edges of G(r) , and θ(r)
is an element in this set. Z (θ(r) )
ij
is the partition function of the MRF on G(r) with parameters θ(r) .
• ˆθ
(r) is a set of parameters on the edges of G such that if edge (ij ) is in G(r) then ˆθ(r)
ij =
Given a distribution ρ(r) on the graphs G(r) (i.e., ρ(r) ≥ 0 for r = 1, . . . , m and P
ij , and otherwise ˆθ(r)
θ(r)
ij = 0.
r ρ(r) = 1),
θ = X
assume that the parameters for G(r) are such that
ρ(r)ˆθ
(r)
r
log Z (θ) ≤ X
Then, by the convexity of the log partition function, as a function of the model parameters, we have
ρ(r) log Z (θ(r) ) ≡ f (θ , ρ, θ(r) )
r
Since by assumption the graphs G(r) are planar, this bound can be calculated in polynomial time.
Since this bound is true for any set of parameters θ(r) which satisﬁes the condition in Equation 5
and for any distribution ρ(r), we may optimize over these two variables to obtain the tightest bound
possible. Deﬁne the optimal bound for a ﬁxed value of ρ(r) by g(ρ, θ) (optimization is w.r.t. θ(r) )
θ(r) :P ρ(r)ˆθ
min

f (θ , ρ, θ(r) )

g(ρ, θ) =

(r)

=θ

(5)

(6)

(7)

1.20.60.70.81.41.51.20.60.70.81.41.5111111111111ρ(r) ≥ 0, P ρ(r) = 1
Also, deﬁne the optimum of the above w.r.t. ρ by h(θ).
min
h(θ) =
Thus, h(θ) is the optimal upper bound for the given parameter vector θ . In the following section we
argue that we can in fact ﬁnd the global optimum of the above problem.

g(θ , ρ)

(8)

4 Globally Optimal Bound Optimization

(r)
ij

k(i,j )

(9)

First consider calculating g(ρ, θ) from Equation 7. Note that since log Z (θ(r) ) is a convex function
of θ(r) , and the constraints are linear, the overall optimization is convex and can be solved efﬁ-
ciently. In the current implementation, we use a projected gradient algorithm [2]. The gradient of
h
i
= ρ(r)(cid:0)1 + eθ
PM ))(cid:1)
f (θ , ρ, θ(r) ) w.r.t. θ(r) is given by
∂ f (θ , ρ, θ(r) )
P −1 (G(r)
Sign(Pk(i,j ) (G(r)
PM )
∂ θ(r)
ij
where k(i, j ) returns the row and column indices of the element in the upper triangular matrix of
(r)
P (G(r)
PM ), which contains the element e2θ
ij .
Since the optimization in Equation 7 is convex, it has an equivalent convex dual. Although we do not
use this dual for optimization (because of the difﬁculty of expressing the entropy of planar models
solely in terms of triplet marginals), it nevertheless allows some insight into the structure of the
θ · τ + X
problem. The dual in this case is closely linked to the notion of the marginal polytope deﬁned in
Section 1. Using a derivation similar to [11], we arrive at the following characterization of the dual
r
where θ(r) (τ ) denotes the parameters of an MRF on G(r) such that its marginals are given by the
restriction of τ to the edges of G(r) , and H (θ(r) (τ )) denotes the entropy of the MRF over G(r)
with parameters θ(r) (τ ). The maximized function in Equation 10 is linear in ρ and thus g(ρ, θ) is a
pointwise maximum over (linear) convex functions in ρ and is thus convex in ρ. It therefore has no
local minima. Denote by θ(r)
min (ρ) the set of parameters that minimizes Equation 7 for a given value
of ρ. Using a derivation similar to that in [11], the gradient of g(ρ, θ) can be shown to be
∂ g(ρ, θ)
∂ ρ(r)

g(ρ, θ) = max
τ ∈TRI(n)

= H (θ(r)
min (ρ))

(11)

ρ(r)H (θ(r) (τ ))

(10)

Since the partition function for G(r) can be calculated efﬁciently, so can the entropy. We can now
summarize the algorithm for calculating h(θ)
• Initialize ρ0 . Iterate:
– For ρt , ﬁnd θ(r) which solves the minimization in Equation 7.
– Calculate the gradient of g(ρ, θ) at ρt using the expression in Equation 11
– Update ρt+1 = ρt + αv where v is a feasible search direction calculated from the
gradient of g(ρ, θ) and the simplex constraints on ρ. The step size α is calculated via
an Armijo line search.
– Halt when the change in g(ρ, θ) is smaller than some threshold.

Note that the minimization w.r.t. θ(r) is not very time consuming since we can initialize it with the
minimum from the previous step, and thus only a few iterations are needed to ﬁnd the new optimum,
provided the change in ρ is not too big. The above algorithm is guaranteed to converge to a global
optimum of ρ [2], and thus we obtain the tightest possible upper bound on Z (θ) given our planar
graph decomposition.
formulation can be obtained by decoupling ρ and θ(r) in the bi-linear constraint P ρ(r)ˆθ
The procedure described here is asymmetric w.r.t. ρ and θ(r) .
In a symmetric formulation the
minimizing gradient steps could be carried out jointly or in an alternating sequence. The symmetric
(r) = θ .

Figure 2: Illustration of planar subgraph construction for a rectangular lattice with external ﬁeld. Original
graph is shown on the left. The ﬁeld vertex is connected to all vertices (edges not shown). The graph on the
right results from isolating the 4th ,5th columns of the original graph (shown in grey), and connecting the ﬁeld
vertex to the external vertices of the three disconnected components. Note that the resulting graph is planar.

Speciﬁcally, we introduce ˜θ(r) = θ(r)ρ(r) and perform the optimization w.r.t. ρ and ˜θ(r) . It can be
shown that a stationary point of f (θ , ρ, ˜θ(r) ) with the relevant (de-coupled) constraint is equivalent
to the procedure described above. The advantage of this approach is that the exact minimization w.r.t
θ(r) is not required before modifying ρ. Our experiments have shown, however, that the methods
take comparable times to converge, although this may be a property of the implementation.

5 Estimating Marginals
The optimization problem as deﬁned above minimizes an upper bound on the partition function.
However, it may also be of interest to obtain estimates of the marginals of the MRF over G. To
obtain marginal estimates, we follow the approach in [11]. We ﬁrst characterize the optimum of
Equation 7 for a ﬁxed value of ρ. Deriving the Lagrangian of Equation 7 w.r.t. θ(r) we obtain the
following characterization of θ(r)
min (ρ):
Marginal Optimality Criterion: For any two graphs G(r) , G(s) such that the edge (ij ) is in both
graphs, the optimal parameter vector satisﬁes τij (θ(r)
min (ρ)) = τij (θ(s)
min (ρ)).
Thus, the optimal set of parameters for the graphs G(r) is such that every two graphs agree on the
marginals of all the edges they share. This implies that at the optimum, there is a well deﬁned set of
marginals over all the edges. We use this set as an approximation to the true marginals.
calculate partition function bounds on the sums: αi (1) = P
P
P
A different method for estimating marginals uses the partition function bound directly. We ﬁrst
P
ij∈E fij (xi ,xj ) and αi (−1) =
x:xi=1 e
αi (1)
αi (1)+αi (−1) to obtain an estimate for p(xi = 1).
ij∈E fij (xi ,xj ) and then normalize
x:xi=−1 e
This method has the advantage of being more numerically stable (since it does not depend on deriva-
tives of log Z ). However, it needs to be calculated separately for each variable, so that it may be
time consuming if one is interested in marginals for a large set of variables.

6 Experimental Evaluation
P
ij∈E θij xi xj +P
We study the application of our Planar Decomposition (PDC) method to a binary MRF on a square
lattice with an external ﬁeld. The MRF is given by p(x) ∝ e
i∈V θi xi where V are
the lattice vertices, and θi and θij are parameters. Note that this interaction does not satisfy the con-
ditions for exact calculation of the partition function, even though the graph is planar. This problem
is in fact NP hard [1]. However, it is possible to obtain the desired interaction form by introducing
P
ij∈E θij xi xj +P
an additional variable xn+1 that is connected to all the original variables. Denote the correspond-
ing graph by Gf . Consider the distribution p(x, xn+1 ) ∝ e
i∈V θi,n+1 xi xn+1 , where
θi,n+1 = θi . It is easy to see that any property of p(x) (e.g., partition function, marginals) may be
calculated from the corresponding property of p(x, xn+1 ). The advantage of the latter distribution
is that it has the desired interaction form. We can thus apply PDC by choosing planar subgraphs of
the non-planar graph Gf .

FieldFigure 3: Comparison of the TRW and Planar Decomposition (PDC) algorithms on a 7×7 square lattice. TRW
results shown in red squares, and PDC in blue circles. Left column shows the error in the log partition bound.
Middle column is the mean error for pairwise marginals, and right column is the error for the singleton marginal
of the variable at the lattice center. Results in upper row are for ﬁeld parameters drawn from U [−0.05, 0.05] and
various interaction parameters. Results in the lower row are for interaction parameters drawn from U [−0.5, 0.5]
and various ﬁeld parameters. Error bars are standard errors calculated from 40 random trials.

There are clearly many ways to choose spanning planar subgraphs of Gf . Spanning subtrees are one
√
option, and were used in [11]. Since our optimization is polynomial in the number of subgraphs,
n. The key idea in generating these
we preferred to use a number of subgraphs that is linear in
planar subgraphs is to generate disconnected components of the lattice and connect xn+1 only to the
external vertices of these components. Here we generate three disconnected components by isolating
√
two neighboring columns (or rows) from the rest of the graph, resulting in three components. This is
illustrated in Figure 2. To this set of 2
n graphs, we add the independent variables graph consisting
only of edges from the ﬁeld node to all the other nodes.
We compared the performance of the PDC and TRW methods 3 4 on a 7 × 7 lattice . Since the exact
partition function and marginals can be calculated for this case, we could compare both algorithms to
the true values. The MRF parameters were set according to the two following scenarios: 1) Varying
Interaction - The ﬁeld parameters θi were drawn uniformly from U [−0.05, 0.05], and the interaction
θij from U [−α, α] where α ∈ {0.2, 0.4, . . . , 2}. This is the setting tested in [11]. 2) Varying Field -
θi was drawn uniformly from U [−α, α], where α ∈ {0.2, 0.4, . . . , 2} and θij from U [−0.5, 0.5].
P
For each scenario, we calculated the following measures: 1) Normalized log partition error
49 (log Z alg − log Z true ). 2) Error in pairwise marginals
ij∈E |palg (xi = 1, xj = 1) −
1|E |
1
ptrue (xi = 1, xj = 1)|. Pairwise marginals were calculated jointly using the marginal optimality
criterion of Section 5. 3) Error in singleton marginals. We calculated the singleton marginals for
the innermost node in the lattice (i.e., coordinate [3, 3]), which intuitively should be the most dif-
ﬁcult for the planar based algorithm. This marginal was calculated using two partition functions,
as explained in Section 5 5 . The same method was used for TRW. The reported error measure is
|palg (xi = 1) − ptrue (xi = 1)|. Results were averaged over 40 random trials.
Results for the two scenarios and different evaluation measures are given in Figure 3. It can be seen
that the partition function bound for PDC is signiﬁcantly better than TRW for almost all parameter
settings, although the difference becomes smaller for large ﬁeld values. Error for the PDC pairwise

3TRW and PDC bounds were optimized over both the subgraph parameters and the mixture parameters ρ.
4 In terms of running time, PDC optimization for a ﬁxed value of ρ took about 30 seconds, which is still
slower than the TRW message passing implementation.
5Results using the marginal optimality criterion were worse for PDC, possibly due to its reduced numerical
precision.

0.511.520.050.10.150.20.25Z Bound ErrorInteraction Strength  PDCTRW0.511.520.020.030.040.050.060.070.08Interaction StrengthPairwise Marginals Error0.511.520.0050.010.0150.020.0250.03Interaction StrengthSingleton Marginal Error0.511.520.0150.020.0250.03Z Bound ErrorField Strength0.511.520.0150.020.0250.03Field StrengthPairwise Marginals Error0.511.523456789x 10!3Field StrengthSingleton Marginal Errormarginals are smaller than those of TRW for all parameter settings. For the singleton parameters,
TRW slightly outperforms PDC. This is not surprising since the ﬁeld is modeled by every spanning
tree in the TRW decomposition, whereas in PDC not all the structures model a given ﬁeld.

7 Discussion

We have presented a method for using planar graphs as the basis for approximating non-planar
graphs such as planar graphs with external ﬁelds. While the restriction to binary variables limits
the applicability of our approach, it remains relevant in many important applications, such as cod-
ing theory and combinatorial optimization. Moreover, it is always possible to convert a non-binary
graphical model to a binary one by introducing additional variables. The resulting graph will typ-
ically not be planar, even when the original graph over k−ary variables is. However, the planar
decomposition method can then be applied to this non-planar graph.
The optimization of the decomposition is carried out explicitly over the planar subgraphs, thus limit-
ing the number of subgraphs that can be used in the approximation. In the TRW method this problem
is circumvented since it is possible to implicitly optimize over all spanning trees. The reason this
can be done for trees is that the entropy of an MRF over a tree may be written as a function of
its marginal variables. We do not know of an equivalent result for planar graphs, and it remains a
challenge to ﬁnd one. It is however possible to combine the planar and tree decompositions into one
single bound, which is guaranteed to outperform the tree or planar approximations alone.
The planar decomposition idea may in principle be applied to bounding the value of the MAP assign-
ment. However, as in TRW, it can be shown that the solution is not dependent on the decomposition
(as long as each edge appears in some structure), and the problem is equivalent to maximizing a lin-
ear function over the marginal polytope (which can be done in polynomial time for planar graphs).
However, such a decomposition may suggest new message passing algorithms, as in [10].

Acknowledgments
The authors acknowledge support from the Defense Advanced Research Projects Agency (Transfer Learning
program). Amir Globerson is also supported by the Rothschild Yad-Hanadiv fellowship. The authors also wish
to thank Martin Wainwright for providing his TRW code.
References
[1] F. Barahona. On the computational complexity of ising spin glass models. J. Phys. A., 15(10):3241–3253,
1982.
[2] D. P. Bertsekas, editor. Nonlinear Programming. Athena Scientiﬁc, Belmont, MA, 1995.
[3] M.M. Deza and M. Laurent. Geometry of Cuts and Metrics. Springe-Verlag, 1997.
[4] R. Diestel. Graph Theory. Springer-Verlag, 1997.
[5] M.E. Fisher. On the dimer solution of planar ising models. J. Math. Phys., 7:1776–1781, 1966.
[6] M.I. Jordan, editor. Learning in graphical models. MIT press, Cambridge, MA, 1998.
[7] P.W. Kasteleyn. Dimer statistics and phase transitions. Journal of Math. Physics, 4:287–293, 1963.
[8] L. Lovasz and M.D. Plummer. Matching Theory, volume 29 of Annals of discrete mathematics. North-
Holland, New-York, 1986.
[9] M. J. Wainwright, T. Jaakkola, and A. S. Willsky. Tree-based reparameterization framework for analysis
of sum-product and related algorithms. IEEE Trans. on Information Theory, 49(5):1120–1146, 2003.
[10] M. J. Wainwright, T. Jaakkola, and A. S. Willsky. Map estimation via agreement on trees: message-
passing and linear programming. IEEE Trans. on Information Theory, 51(11):1120–1146, 2005.
[11] M. J. Wainwright, T. Jaakkola, and A. S. Willsky. A new class of upper bounds on the log partition
function. IEEE Trans. on Information Theory, 51(7):2313–2335, 2005.
[12] M.J. Wainwright and M.I. Jordan. Graphical models, exponential families, and variational inference.
Technical report, UC Berkeley Dept. of Statistics, 2003.
[13] J.S. Yedidia, W.T. W.T. Freeman, and Y. Weiss. Constructing free-energy approximations and generalized
belief propagation algorithms. IEEE Trans. on Information Theory, 51(7):2282–2312, 2005.

