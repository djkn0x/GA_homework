Hidden Markov Dirichlet Process: Modeling Genetic
Recombination in Open Ancestral Space

Kyung-Ah Sohn
School of Computer Science
Carnegie Mellon University
Pittsburgh, PA 15213
ksohn@cs.cmu.edu

Eric P. Xing
School of Computer Science
Carnegie Mellon University
Pittsburgh, PA 15213
epxing@cs.cmu.edu

Abstract
We present a new statistical framework called hidden Markov Dirichlet process
(HMDP) to jointly model the genetic recombinations among possibly inﬁnite
number of founders and the coalescence-with-mutation events in the resulting ge-
nealogies. The HMDP posits that a haplotype of genetic markers is generated by
a sequence of recombination events that select an ancestor for each locus from
an unbounded set of founders according to a 1st-order Markov transition process.
Conjoining this process with a mutation model, our method accommodates both
between-lineage recombination and within-lineage sequence variations, and leads
to a compact and natural interpretation of the population structure and inheritance
process underlying haplotype data. We have developed an efﬁcient sampling algo-
rithm for HMDP based on a two-level nested P ´olya urn scheme. On both simulated
and real SNP haplotype data, our method performs competitively or signiﬁcantly
better than extant methods in uncovering the recombination hotspots along chro-
mosomal loci; and in addition it also infers the ancestral genetic patterns and offers
a highly accurate map of ancestral compositions of modern populations.

1 Introduction
Recombinations between ancestral chromosomes during meiosis play a key role in shaping the pat-
terns of linkage disequilibrium (LD)—the non-random association of alleles at different loci—in
a population. When a recombination occurs between two loci, it tends to decouple the alleles
carried at those loci in its descendants and thus reduce LD; uneven occurrence of recombination
events along chromosomal regions during genetic history can lead to “block structures” in molec-
ular genetic polymorphisms such that within each block only low level of diversities are present
in a population. The problem of inferring chromosomal recombination hotspots is essential for
understanding the origin and characteristics of genome variations; several combinatorial and sta-
tistical approaches have been developed for uncovering optimum block boundaries from single
nucleotide polymorphism (SNP) haplotypes [Daly et al., 2001; Anderson and Novembre, 2003;
Patil et al., 2001; Zhang et al., 2002], and these advances have important applications in genetic
analysis of disease propensities and other complex traits. The deluge of SNP data also fuels the
long-standing interest of analyzing patterns of genetic variations to reconstruct the evolutionary
history and ancestral structures of human populations, using, for example, variants of admixture
models on genetic polymorphisms [Rosenberg et al., 2002]. These progress notwithstanding, the
statistical methodologies developed so far mostly deal with LD analysis and ancestral inference
separately, using specialized models that do not capture the close statistical and genetic relation-
ships of these two problems. Moreover, most of these approaches ignore the inherent uncertainty
in the genetic complexity (e,g., the number of genetic founders of a population) of the data and
rely on inﬂexible models built on a pre-ﬁxed, closed genetic space. Recently, Xing et al. [2004;
2006] have developed a nonparametric Bayesian framework for modeling genetic polymorphisms
based on the Dirichlet process mixtures and extensions, which attempts to allow more ﬂexible con-
trol over the number of genetic founders than has been provided by the statistical methods proposed
thus far. In this paper, we leverage on this approach and present a uniﬁed framework to model com-
plex genetic inheritance process that allows recombinations among possibly inﬁnite founding alleles
and coalescence-with-mutation events in the resulting genealogies.

Figure 1: An illustration of a hidden Markov Dirichlet process for haplotype recombination and
inheritance.
We assume that individual chromosomes in a modern population are originated from an unknown
number of ancestral haplotypes via biased random recombinations and mutations (Fig 1). The re-
combinations between the ancestors follow a a state-transition process we refer to as hidden Markov
Dirichlet process (originated from the inﬁnite HMM by Beal et al. [2001]), which travels in an open
ancestor space, with nonstationary recombination rates depending on the genetic distances between
SNP loci. Our model draws inspiration from the HMM proposed in [Greenspan and Geiger, 2003],
but we employ a two-level P ´olya urn scheme akin to the hierarchical DP [Teh et al., 2004] to ac-
commodate an open ancestor space, and allow full posterior inference of the recombination sites,
mutation rates, haplotype origin, ancestor patterns, etc., conditioning on phased SNP data, rather
than estimating them using information theoretic or maximum likelihood principles. On both simu-
lated and real genetic data, our model and algorithm show competitive or superior performance on
a number of genetic inference tasks over the state-of-the-art parametric methods.
2 Hidden Markov Dirichlet Process for Recombination
Sequentially choosing recombination targets from a set of ancestral chromosomes can be modeled
as a hidden Markov process [Niu et al., 2002; Greenspan and Geiger, 2003], in which the hidden
states correspond to the index of the candidate chromosomes, the transition probabilities correspond
to the recombination rates between the recombining chromosome pairs, and the emission model
corresponds to a mutation process that passes the chosen chromosome region in the ancestors to
the descents. When the number of ancestral chromosomes is not known, it is natural to consider an
HMM whose state space is countably inﬁnite [Beal et al., 2001; Teh et al., 2004]. In this section,
we describe such an inﬁnite HMM formalism, which we would like to call hidden Markov Dirichlet
process, for modeling recombination in an open ancestral space.
2.1 Dirichlet Process mixtures
For self-containedness, we begin with a brief recap of the basic Dirichlet process mixture model
proposed in Xing et al. [2004] for haplytope inheritance without recombination. A haplotype
refers to the joint allele conﬁguration of a contiguous list of SNPs located on a single chromosome
(Fig 1). Under a well-known genetic model known as coalescence-with-mutation (but without
recombination), one can treat a haplotype from a modern individual as a descendent of an unknown
ancestor haplotype (i.e., a founder) via random mutations that alter the allelic states of some
SNPs. It can be shown that such a coalescent process in an inﬁnite population leads to a partition
of the population that can be succinctly captured by the following P ´olya urn scheme. Consider
an urn that at the outset contains a ball of a single color. At each step we either draw a ball
from the urn and replace it with two balls of the same color, or we are given a ball of a new
color which we place in the urn. One can see that such a scheme leads to a partition of the balls
according to their color. Letting parameter τ deﬁne the probabilities of the two types of draws, and
viewing each (distinct) color as a sample from Q0 , and each ball as a sample from Q, Blackwell
and MacQueen [1973] showed that this P ´olya urn model yields samples whose distributions
are those of the marginal probabilities under the Dirichlet process. One can associate mixture
component with colors in the P ´olya urn model, and thereby deﬁne a “clustering” of the data. The
resulting model is known as a DP mixture. Note that a DP mixture requires no prior speciﬁca-
tion of the number of components. Back to haplotype modeling, following Xing et al. [2004;
2006], let Hi = [Hi,1 , . . . , Hi,T ] denote a haplotype over T SNPs from chromosome i 1 ; let
Ak = [Ak,1 , . . . , Ak,T ] denote an ancestor haplotype (indexed by k) and θk denote the mutation
rate of ancestor k ; and let Ci denote an inheritance variable that speciﬁes the ancestor of haplotype
Hi . As described in Xing et al. [2006], under a DP mixture, we have the following P ´olya urn
1We ignore the parental origin index of haplotype as used in Xing et al. [2004], and assume that the paternal
and maternal haplotypes of each individual are given unambiguously (i.e., phased, as known in genetics),
as is the case in many LD and haplotype-block analyses. But it is noteworthy that our model can generalize
straightforwardly to unphased genotype data by incorporating a simple genotype model as in Xing et al. [2004].

Inheritance of unknown generations....1 A2 A3 AKA 0iH 1iH Loci: 12345sample the 1st founder;
sample the 1st haplotype from an inheritance model deﬁned on the 1st founder;

scheme for sampling modern haplotypes:
• Draw ﬁrst haplotype:
a1 | DP(τ , Q0 ) ∼ Q0 (·),
h1 ∼ Ph (·|a1 , θ1 ),
• for subsequent haplotypes:
– sample the founder indicator for the ith haplotype:
ci |DP(τ , Q0 ) ∼( p(ci = cj for some j < i|c1 , . . ., ci−1 ) =
ncj
i−1+τ
p(ci 6= cj for all j < i|c1 , . . ., ci−1 ) = τ
i−1+τ
where nci is the occupancy number of class ci—the number of previous samples belonging to class ci .
– sample the founder of haplotype i (indexed by ci ):
φci |DP(τ , Q0 )  = {acj , θcj } if ci = cj for some j < i (i.e., ci refers to an inherited founder)
∼ Q0 (a, θ) if ci 6= cj for all j < i (i.e., ci refers to a new founder)
– sample the haplotype according to its founder:
hi | ci ∼ Ph (·|aci , θci ).
Notice that the above generative process assumes each modern haplotype to be originated from a
single ancestor, this is only plausible for haplotypes spanning a short region on a chromosome. Now
we consider long haplotypes possibly bearing multiple ancestors due to recombinations between an
unknown number of founders.
2.2 Hidden Markov Dirichlet Process (HMDP)
In a standard HMM, state-transitions across a discrete time- or space-interval take place in a ﬁxed-
dimensional state space, thus it can be fully parameterized by, say, a K -dimensional initial-state
probability vector and a K × K state-transition probability matrix. As ﬁrst proposed in Beal et
al. [2001], and later discussed in Teh et al. [2004], one can “open” the state space of an HMM
by treating the now inﬁnite number of discrete states of the HMM as the support of a DP, and the
transition probabilities to these states from some source as the masses associated with these states.
In particular, for each source state, the possible transitions to the target states need to be modeled
by a unique DP. Since all possible source states and target states are taken from the same inﬁnite
state space, overall we need an open set of DPs with different mass distributions on the SAME
support (to capture the fact that different source states can have different transition probabilities to
any target state). In the sequel, we describe such a nonparametric Bayesian HMM using an intuitive
hierarchical P ´olya urn construction. We call this model a hidden Markov Dirichlet process.
In an HMDP, both the columns and rows of the transition matrix are inﬁnite dimensional. To con-
struct such an stochastic matrix, we will exploit the fact that in practice only a ﬁnite number of states
(although we don’t know what they are) will be visited by each source state, and we only need to
keep track of these states. The following sampling scheme based on a hierarchical P ´olya urn scheme
captures this spirit and yields a constructive deﬁnition of HMDP.
We set up a single “stock” urn at the top level, which contains balls of colors that are represented
by at least one ball in one or multiple urns at the bottom level. At the bottom level, we have a set
of distinct urns which are used to deﬁne the initial and transition probabilities of the HMDP model
(and are therefore referred as HMM-urns). Speciﬁcally, one of HMM urns, u0 , is set aside to hold
colored balls to be drawn at the onset of the HMM state-transition sequence. Each of the remaining
HMM urns is painted with a color represented by at least one ball in the stock urn, and is used
to hold balls to be drawn during the execution of a Markov chain of state-transitions. Now let’s
and urns u1 , . . . , uK , let mj,k denote the number of balls of color k in urn uj , and mj = P
suppose that at time t the stock urn contains n balls of K distinct colors indexed by an integer set
C = {1, 2, . . . , K }; the number of balls of color k in this urn is denoted by nk , k ∈ C . For urn u0
k∈C mj,k
denote the total number of balls in urn uj . Suppose that at time t − 1, we had drawn a ball with
color k 0 . Then at time t, we either draw a ball randomly from urn uk0 , and place back two balls both
mj +τ we turn to the top level. From the stock urn, we can either
of that color; or with probability
τ
draw a ball randomly and put back two balls of that color to the stock urn and one to uk0 , or obtain
a ball of a new color K + 1 with probability γ
n+γ and put back a ball of this color to both the stock
urn and urn uk0 of the lower level. Essentially, we have a master DP (the stock urn) that serves as
a base measure for inﬁnite number of child DPs (HMM-urns). As pointed out in Teh et al. [2004],
this model can be viewed as an instance of the hierarchical Dirichlet process mixture model.
As discussed in Xing et al. [2006], associating each color k with an ancestor conﬁguration
φk = {ak , θk } whose values are drawn from the base measure F ≡ B eta(θ)p(a), conditioning
on the Dirichlet process underlying the stock urn, the samples in the j th bottom-level urn are also
distributed as marginals under a Dirichlet measure:

φmj |φ−mj ∼ K
X
k=1

nk
mj,k + τ
n−1+γ
mj − 1 + τ

δφ∗
k

(φmj ) +

τ
mj − 1 + τ

γ
n − 1 + γ

F (φmj )

=

πj,k δφ∗
k

(1)

(φmj ) + πj,K+1F (φmj ),

K
X
k=1
where πj,k ≡ mj,k+τ
n−1+γ . Let πj ≡ [πj,1 , πj,2 , . . .], now we have an
, πj,K+1 ≡
nk
n−1+γ
γ
τ
mj −1+τ
mj −1+τ
inﬁnite-dimensional Bayesian HMM that, given F , γ , τ , and all initial states and transitions sampled
so far, follows an initial states distribution parameterized by π0 , and transition matrix Π whose rows
are deﬁned by {πj : j > 0}. As in Xing et al. [2006], we also introduce vague inverse Gamma
priors for the concentration parameters γ and τ .
2.3 HMDP Model for Recombination and Inheritance
Now we describe a stochastic model, based on an HMDP, for generating individual haplotypes
in a modern population from a hypothetical pool of ancestral haplotypes via recombination and
mutations (i.e., random mating with neutral selection). For each modern chromosome i, let Ci =
[Ci,1 , . . . , Ci,T ] denote the sequence of inheritance variables specifying the index of the ancestral
chromosome at each SNP locus. When no recombination takes place during the inheritance process
that produces haplotype Hi (say, from ancestor k), then Ci,t = k , ∀t. When a recombination occurs,
say, between loci t and t + 1, we have Ci,t 6= Ci,t+1 . We can introduce a Poisson point process
to control the duration of non-recombinant inheritance. That is, given that Ci,t = k , then with
probability e−dr +(1−e−dr )πkk , where d is the physical distance between two loci, r reﬂects the rate
of recombination per unit distance, and πkk is the self-transition probability of ancestor k deﬁned by
HMDM, we have Ci,t+1 = Ci,t ; otherwise, the source state (i.e., ancestor chromosome k) pairs with
a target state (e.g., ancestor chromosome k 0 ) between loci t and t+1, with probability (1−e−dr )πkk0 .
Hence, each haplotype Hi is a mosaic of segments of multiple ancestral chromosomes from the
ancestral pool {Ak,· }∞
k=1 . Essentially, the model we described so far is a time-inhomogeneous
inﬁnite HMM. When the physical distance information between loci is not available, we can simply
set r to be inﬁnity so that we are back to a standard stationary HMDP model.
I(ht=at )(cid:16) 1 − θ
(cid:17)I(ht 6=at )
The emission process of the HMDM corresponds to an inheritance model from an ancestor to the
matching descendent. For simplicity, we adopt the single-locus mutation model in Xing et al. [2004]:
p(ht |at , θ) = θ
|B | − 1
where ht and at denote the alleles at locus t of an individual haplotype and its corresponding an-
cestor, respectively; θ indicates the ancestor-speciﬁc mutation rate; and |B | denotes the number of
possible alleles. As discussed in Liu et al. [2001], this model corresponds to a star genealogy re-
sulted from infrequent mutations over a shared ancestor, and is widely used in statistical genetics
as an approximation to a full coalescent genealogy. Following Xing et al. [2004], assume that the
mutation rate θ admits a Beta prior, the marginal conditional likelihood of a haplotype given its
matching ancestor can be computed by integrating out θ under the Bayesian rule.
3 Posterior Inference
Now we proceed to describe a Gibbs sampling algorithm for posterior inference under HMDP. The
variables of interest include {Ci,t }, the inheritance variables specifying the origins of SNP alleles of
all loci on each haplotype; and {Ak,t}, the founding alleles at all loci of each ancestral haplotype.
The Gibbs sampler alternates between two sampling stages. First it samples the inheritance variables
{ci,t}, conditioning on all given individual haplotypes h = {h1 , . . . , h2N }, and the most recently
sampled conﬁguration of the ancestor pool a = {a1 , . . . , aK }; then given h and current values of
the ci,t ’s, it samples every ancestor ak .
To improve the mixing rate, we sample the inheritance variables one block at a time. That is, every
time we sample δ consecutive states ct+1 , . . . , ct+δ starting at a randomly chosen locus t + 1 along
a haplotype. (For simplicity we omit the haplotype index i here and in the forthcoming expositions
when it is clear from context that the statements or formulas apply to all individual haplotypes.)
Let c− denote the set of previously sampled inheritance variables. Let n denote the totality of
occupancy records of the top-level DP (i.e. the “stock urn”) — {n} ∪ {nk : ∀k}; and m denote
the totality of the occupancy records of each lower-level DPs (i.e., the urns corresponding to the
recombination choices by each ancestor) — {mk : ∀k} ∪ {mk,k0
: ∀k , k 0 }. And let lk denote the
sufﬁcient statistics associated with all haplotype instances originated from ancestor k . The predictive

(2)

,

(3)

distribution of a δ -block of inheritance variables can be written as:
p(ct+1:t+δ |c− , h, a) ∝ p(ct+1:t+δ |ct , ct+δ+1 , m, n)p(ht+1:t+δ |act+1 ,t+1 , . . . , act+δ ,t+δ )
∝ t+δY
t+δY
p(cj+1 |cj , m, n)
p(hj |acj ,j , lcj ).
j=t
j=t+1
This expression is simply Bayes’ theorem with p(ht+1:t+δ |act+1 ,t+1 , . . . , act+δ ,t+δ ) playing the role
of the likelihood and p(ct+1:t+δ |c− , h, a) playing the role of the prior. One should be careful that
the sufﬁcient statistics n, m and l employed here should exclude the contributions by samples asso-
ciated with the δ -block to be sampled. Note that naively, the sampling space of an inheritance block
of length δ is |A|δ where |A| represents the cardinality of the ancestor pool. However, if we assume
that the recombination rate is low and block length is not too big, then the probability of having
two or more recombination events within a δ -block is very small and thus can be ignored. This ap-
proximation reduces the sampling space of the δ -block to O(|A|δ), i.e., |A| possible recombination
t+δY
targets times δ possible recombination locations. Accordingly, Eq. (3) reduces to:
p(ct+1:t+δ |c− , h, a) ∝ p(ct0 |ct0−1 = ct , m, n)p(ct+δ+1 |ct+δ = ct0 , m, n)
p(hj |act0 ,j , lct0 )
j=t0
for some t0 ∈ [t + 1, t + δ ]. Recall that in an HMDP model for recombination, given that the total
recombination probability between two loci d-units apart is λ ≡ 1 − e−dr ≈ dr (assuming d and r
are both very small), the transition probability from state k to state k 0 is:
(cid:26) λπk,k0 + (1 − λ)δ(k , k 0 )
p(ct0 = k 0 |ct0−1 = k , m, n, r, d)
for k 0 ∈ {1, ..., K }, i.e., transition to an existing ancestor,
for k 0 = K + 1, i.e., transition to a new ancestor,
λπk,K+1
where πk represents the transition probability vector for ancestor k under HMDP, as deﬁned in
Eq. (1). Note that when a new ancestor aK+1 is instantiated, we need to immediately instantiate a
new DP under F to model the transition probabilities from this ancestor to all instantiated ancestors
(including itself). Since the occupancy record of this DP, mK+1 := {mK+1 } ∪ {mK+1,k : k =
1, . . . , K + 1}, is not yet deﬁned at the onset, with probability 1 we turn to the top-level DP when
departing from state K + 1 for the ﬁrst time. Speciﬁcally, we deﬁne p(·|ct0 = K + 1) according to
the occupancy record of ancestors in the stock urn. For example, at the distal boarder of the δ -block,
since ct+δ+1 always indexes a previously inherited ancestor (and therefore must be present in the
stock-urn), we have:

(4)

=

.

(5)

p(ct+δ+1 |ct+δ = K + 1, m, n) = λ × nct+δ+1
n + γ
Now we can substitute the relevant terms in Eq. (3) with Eqs. (4) and (5). The marginal likelihood
term in Eq. (3) can be readily computed based on Eq. (2), by integrating out the mutation rate
θ under a Beta prior (and also the ancestor a under a uniform prior if ct0 refers to an ancestor
to be newly instantiated) [Xing et al., 2004]. Putting everything together, we have the proposal
distribution for a block of inheritance variables. Upon sampling every ct , we update the sufﬁcient
statistics n, m and {lk } as follows. First, before drawing the sample, we erase the contribution of
ct to these sufﬁcient statistics. In particular, if an ancestor gets no occupancy in either the stock
and the HMM urns afterwards, we remove it from our repository. Then, after drawing a new ct , we
increment the relevant counts accordingly. In particular, if ct = K + 1 (i.e., a new ancestor is to
be drawn), we update n = n + 1, set nK+1 = 1, mct = mct + 1, mct ,K+1 = 1, and set up a new
(empty) HMM urn with color K + 1 (i.e. instantiating mK+1 with all elements equal to zero).
Now we move on to sample the founders {ak,t}, following the same proposal given in Xing et
p(ak,t |c, h) ∝ Y
al. [2006], which is adapted below for completeness:
0
Γ(αh + lk,t )Γ(βh + l
k,t )
p(hi,t |ak,t ) =
k,t )(|B | − 1)l
0
Γ(αh + βh + lk,t + l
k,t = P
i,t|ci,t=k
where lk,t is the number of allelic instances originating from ancestor k at locus t that are identical to
I(ci,t = k |ak,t ) − lk,t represents
0
the ancestor, when the ancestor has the pattern ak,t ; and l
i
0
k,t both to zero. Note that
the complement. If k is not represented previously, we can just set lk,t and l
when sampling a new ancestor, we can only condition on a small segment of an individual haplotype.
To instantiate a complete ancestor, after sampling the alleles in the ancestor corresponding to the
segment according to Eq. (6), we ﬁrst ﬁll in the rest of the loci with random alleles. When another

R(αh , βh ),

(6)

0
k,t

segment of an individual haplotype needs a new ancestor, we do not naively create a new full-
length ancestor; rather, we use the empty slots (those with random alleles) of one of the previously
instantiated ancestors, if any, so that the number of ancestors does not grow unnecessarily.
4 Experiments
We applied the HMDP model to both simulated and real haplotype data. Our analyses focus on
the following three popular problems in statistical genetics: 1. Ancestral Inference: estimating the
number of founders in a population and reconstructing the ancestor haplotypes; 2) LD-block Anal-
ysis: inferring the recombination sites in each individual haplotype and uncover population-level
recombination hotspots on the chromosome region; 3) Population Structural Analysis: mapping the
genetic origins of all loci of each individual haplotype in a population.

Figure 2: Analysis of simulated haplotype populations. (a) A com-
parison of ancestor reconstruction errors for the ﬁve ancestors (indexed
along x-axis). The vertical lines show ±1 standard deviation over 30
populations. (b) A plot of the empirical recombination rates along 100
SNP loci in one of the 30 populations. The dotted lines show the pre-
speciﬁed recombination hotspots. (c) The true (panel 1) and estimated
(panel 2 for HMDP, and panel 3-5 for 3 HMMs) population maps of
ancestral compositions in a simulated population. Figures were gener-
ated using the software distruct from Rosenberg et al [2002].
4.1 Analyzing simulated haplotype population
To simulate a population of individual haplotypes, we started with a ﬁxed number, Ks (unknown to
the HMDP model), of randomly generated ancestor haplotypes, on each of which a set of recom-
bination hotspots are (randomly) pre-speciﬁed. Then we applied a hand-speciﬁed recombination
process, which is deﬁned by a Ks -dimensional HMM, to the ancestor haplotypes to generate Ns
individual haplotypes, via sequentially recombining segments of different ancestors according to
the simulated HMM states at each locus, and mutating certain ancestor SNP alleles according to
the emission model. At the hotspots, we deﬁned the recombination rate to be 0.05, otherwise it
is 0.00001. Each individual was forced to have at least one recombination. Overall, 30 datasets
each containing 100 individuals (i.e., 200 haplotypes) with 100 SNPs were generated from Ks = 5
ancestor haplotypes. As baseline models, we also implemented 3 standard ﬁxed-dimensional
HMM, with 3, 5 (the true number of ancestors for the simulated) and 10 hidden states, respectively.
Ancestral Inference Using HMDP, we successfully recovered the correct number (i.e., K = 5)
of ancestors in 21 out of 30 simulated populations; for the remaining 9 populations, we inferred 6
ancestors. From samples of ancestor states {ak,t}, we reconstructed the ancestral haplotypes under
the HMDP model. For comparison, we also inferred the ancestors under the 3 standard HMM using
an EM algorithm. We deﬁne the ancestor reconstruction error a for each ancestor to be the ratio
of incorrectly recovered loci over all the chromosomal sites. The average a over 30 simulated
populations under 4 different models are shown in Fig 2a. In particular, the average reconstruc-
tion errors of HMDP for each of the ﬁve ancestors are 0.026, 0.078, 0.116, 0.168, and 0.335,
respectively. There is a good correlation between the reconstruction quality and the population
frequency of each ancestor. Speciﬁcally, the average (over all simulated populations) fraction of
SNP loci originated from each ancestor among all loci in the population is 0.472,0.258,0.167,0.068
and 0.034, respectively. As one would expect, the higher the population frequency an ancestor
is, the better its reconstruction accuracy. Interestingly, under the ﬁxed-dimensional HMM, even
when we use the correct number of ancestor states, i.e., K = 5, the reconstruction error is still
very high (Fig 2), typically 2.5 times or higher than the error of HMDP. We conjecture that this is
because the non-parametric Bayesian treatment of the transition rates and ancestor conﬁgurations
under the HMDP model leads to a desirable adaptive smoothing effect and also less constraints
on the model parameters, which allow them to be more accurately estimated. Whereas under a
parametric setting, parameter estimation can easily go sub-optimum due to lack of appropriate
smoothing or prior constraints, or deﬁciency of the learning algorithm (e.g., local-optimality of EM).

a.b..ancestor reconstruction errorempirical recombination ratec.12354a

b

.
.
Figure 3: Analysis of the Daly data. (a) A plot of λe estimated via HMDP; and the haplotype block boundaries
according to HMDP (black solid line), HMM [Daly et al., 2001] (red dotted line), and MDL [Anderson and
Novembre, 2003]) (blue dashed line). (b) IT scores for haplotype blocks from each method.
LD-block Analysis From samples of the inheritance variables {ci,t } under HMDP, we can infer
the recombination status of each locus of each haplotype. We deﬁne the empirical recombination
rates λe at each locus to be the ratio of individuals who had recombinations at that locus over the
total number of haploids in the population. Fig 2b shows a plot of the λe in one of the 30 simulated
populations. We can identify the recombination hotspots directly from such a plot based on an
empirical threshold λt (i.e., λt = 0.05). For comparison, we also give the true recombination
hotspots (depicted as dotted vertical lines) chosen in the ancestors for simulating the recombinant
population. The inferred hotspots (i.e., the λe peaks) show reasonable agreement with the reference.
Population Structural Analysis Finally, from samples of the inheritance variables {ci,t }, we can
also uncover the genetic origins of all loci of each individual haplotype in a population. For each
individual, we deﬁne an empirical ancestor composition vector ηe , which records the fractions of
every ancestor in all the ci,t ’s of that individuals. Fig 2c displays a population map constructed from
the ηe ’s of all individual. In the population map, each individual is represented by a thin vertical
line which is partitioned into colored segments in proportion to the ancestral fraction recorded by
ηe . Five population maps, corresponding to (1) true ancestor compositions, (2) ancestor composi-
tions inferred by HMDP, and (3-5) ancestor compositions inferred by HMMs with 3, 5, 10 states,
respectively, are shown in Fig 2c. To assess the accuracy of our estimation, we calculated the dis-
tance between the true ancestor compositions and the estimated ones as the mean squared distance
between true and the estimated ηe over all individuals in a population, and then over all 30 simulated
populations. We found that the distance between the HMDP-derived population map and the true
map is 0.190, whereas the distance between HMM-map and true map is 0.319, signiﬁcantly worse
than that of HMDP even though the HMM is set to have the true number of ancestral states (i.e.,
K = 5). Because of dimensionality incompatibility and apparent dissimilarity to the true map for
other HMMs (i.e., K = 3 and 10), we forgo the above quantitative comparison for these two cases.

4.2 Analyzing two real haplotype datasets
We applied HMDP to two real haplotype datasets, the single-population Daly data [Daly et al.,
2001], and the two-population (CEPH: Utah residents with northern/western European ancestry;
and YRI: Yoruba in Ibadan and Nigeria) HapMap data [Thorisson et al., 2005]. These data consist
of trios of genotypes, so most of the true haplotypes can be directly inferred from the genotype data.
We ﬁrst analyzed the 256 individuals from Daly data We compared the recovered recombination
hotspots with those reported in Daly et al. [2001] (which is based on an HMM employing different
number of states at different chromosome segments) and in Anderson and Novembre [2003] (which
is based on a minimal description length (MDL) principle). Fig. 3a shows the plot of empirical
recombination rates estimated under HMDP, side-by-side with the reported recombination hotspots.
There is no ground truth to judge which one is correct; hence we computed information-theoretic
(IT) scores based on the estimated within-block haplotype frequencies and the between-block tran-
sition probabilities under each model for a comparison. The left panel of Fig 3b shows the total
pairwise mutual information between adjacent haplotype blocks segmented by the recombination
hotspots uncovered by the three methods. The right panel shows the average entropies of haplotypes
within each block. The number above each bar denotes the total number of blocks. The pairwise
mutual information score of the HMDP block structure is similar to that of the Daly structure, but
smaller than that of MDL. Similar tendencies are observed for average entropies. Note that the Daly
and the MDL methods allow the number of haplotype founders to vary across blocks to get the most
compact local ancestor constructions. Thus their reported scores might be an underestimate of the
true global score because certain segments of an ancestor haplotype that are not or rarely inherited
are not counted in the score. Thus the low IT scores achieved by HMDP suggest that HMDP can
effectively avoid inferring spurious global and local ancestor patterns. This is conﬁrmed by the pop-
ulation map shown in Fig 4a, which shows that HMDP recovered 6 ancestors and among them the 3
dominant ancestors account for 98% of all the modern haplotypes in the population.

a

b

Figure 4: The estimated population maps: (a) Daly data. (b) HapMap data.
The HapMap data contains 60 individuals from CEPH and 60 from YRI. We applied HMDP to
the union of the populations, with a random individual order. The two-population structure is
clearly retrieved from the population map constructed from the population composition vectors ηe
for every individual. As seen in Fig. 4b, the left half of the map clearly represents the CEPH
population and the right half the YRI population. We found that the two dominant haplotypes
covered over 85% of the CEPH population (and the overall breakup among all four ancestors is
0.5618,0.3036,0.0827,0.0518). On the other hand, the frequencies of each ancestor in YRI popula-
tion are 0.2141,0.1784,0.3209,0.1622,0.1215 and 0.0029, showing that the YRI population is much
more diverse than CEPH. Due to space limit, we omit the recombination map of this dataset.
5 Conclusion
We have proposed a new Bayesian approach for joint modeling genetic recombinations among pos-
sibly inﬁnite founding alleles and coalescence-with-mutation events in the resulting genealogies.
By incorporating a hierarchical DP prior to the stochastic matrix underlying an HMM, which fa-
cilitates well-deﬁned transition process between inﬁnite ancestor space, our proposed method can
efﬁciently infer a number of important genetic variables, such as recombination hotspot, mutation
rates, haplotype origin, and ancestor patterns, jointly under a uniﬁed statistical framework.
Emprirically, on both simulated and real data, our approach compares favorably to its parametric
counterpart—a ﬁxed-dimensional HMM (even when the number of its hidden state, i.e., the ances-
tors, is correctly speciﬁed) and a few other specialized methods, on ancestral inference, haplotype-
block uncovering and population structural analysis. We are interested in further investigating the
behavior of an alternative scheme based on reverse-jump MCMC over Bayesian HMMs with differ-
ent latent states in comparison with HMDP; and we intend to apply our methods to genome-scale
LD and demographic analysis using the full HapMap data. While our current model employs only
phased haplotype data, it is straightforward to generalize it to unphased genotype data as provided
by the HapMap project. HMDP can also be easily adapted to many engineering and information
retrieval contexts such as object and theme tracking in open space. Due to space limit, we left out
some details of the algorithms and more results of our experiments, which are available in the full
version of this paper [Xing and Sohn, 2006].
References
[Anderson and Novembre, 2003] E. C. Anderson and J. Novembre. Finding haplotype block boundaries by using the minimum-description-
length principle. Am J Hum Genet, 73:336–354, 2003.
[Beal et al., 2001] M. J. Beal, Z. Ghahramani, and C. E. Rasmussen. The inﬁnite hidden Markov model. In Advances in Neural Information
Processing Systems 13, 2001.
[Blackwell and MacQueen, 1973] D. Blackwell and J. B. MacQueen. Ferguson distributions via polya urn schemes. Annals of Statistics,
1:353–355, 1973.
[Daly et al., 2001] M. J. Daly, J. D. Rioux, S. F. Schaffner, T. J. Hudson, and E. S. Lander. High-resolution haplotype structure in the human
genome. Nature Genetics, 29(2):229–232, 2001.
[Greenspan and Geiger, 2003] D. Greenspan and D. Geiger. Model-based inference of haplotype block variation. In Proceedings of RECOMB
2003, 2003.
[Liu et al., 2001] J. S. Liu, C. Sabatti, J. Teng, B.J.B. Keats, and N. Risch. Bayesian analysis of haplotypes for linkage disequilibrium
mapping. Genome Res., 11:1716–1724, 2001.
[Niu et al., 2002] T. Niu, S. Qin, X. Xu, and J. Liu. Bayesian haplotype inference for multiple linked single nucleotide polymorphisms.
American Journal of Human Genetics, 70:157–169, 2002.
[Patil et al., 2001] N. Patil, A. J. Berno, D. A. Hinds, et al. Blocks of limited haplotype diversity revealed by high-resolution scanning of
human chromosome 21. Science, 294:1719–1723, 2001.
[Rosenberg et al., 2002] N. A. Rosenberg, J. K. Pritchard, J. L. Weber, H. M. Cann, K. K. Kidd, L. A. Zhivotovsky, and M. W. Feldman.
Genetic structure of human populations. Science, 298:2381–2385, 2002.
[Teh et al., 2004] Y. Teh, M. I. Jordan, M. Beal, and D. Blei. Hierarchical Dirichlet processes. Technical Report 653, Department of Statistics,
University of California, Berkeley, 2004.
[Thorisson et al., 2005] G.A. Thorisson, A.V. Smith, L. Krishnan, and L.D. Stein. The international hapmap project web site. Genome
Research, 15:1591–1593, 2005.
[Xing et al., 2004] E.P. Xing, R. Sharan, and M.I Jordan. Bayesian haplotype inference via the Dirichlet process. In Proceedings of the 21st
International Conference on Machine Learning, 2004.
[Xing et al., 2006] E.P. Xing, K.-A. Sohn, M.I Jordan, and Y. W. Teh. Bayesian multi-population haplotype inference via a hierarchical
dirichlet process mixture. In Proceedings of the 23st International Conference on Machine Learning, 2006.
[Xing and Sohn, 2006] E.P. Xing and K.-A. Sohn. Hidden Markov Dirichlet Process: Modeling Genetic Recombination in Open Ancestral
Space. In Bayesian Analysis, to appear, 2007.
[Zhang et al., 2002] K. Zhang, M. Deng, T. Chen, M. Waterman, and F. Sun. A dynamic programming algorithm for haplotype block
partitioning. Proc. Natl. Acad. Sci. USA, 99(11):7335–39, 2002.

